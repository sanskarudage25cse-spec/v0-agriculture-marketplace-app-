import { type NextRequest, NextResponse } from "next/server"

interface FarmingKnowledge {
  keywords: string[]
  responses: { [key: string]: string }
}

const farmingKnowledgeBase: { [key: string]: FarmingKnowledge } = {
  crops: {
    keywords: [
      "crop",
      "crops",
      "wheat",
      "rice",
      "corn",
      "maize",
      "cotton",
      "sugarcane",
      "potato",
      "tomato",
      "onion",
      "garlic",
      "soybean",
      "mustard",
      "barley",
      "millet",
      "bajra",
      "jowar",
      "ragi",
      "cultivation",
      "farming",
      "grow",
      "plant",
      "harvest",
    ],
    responses: {
      en: "For successful crop cultivation in India:\n\nЁЯМ▒ **Soil Preparation**: Test soil pH (6.0-7.5 ideal), add organic compost 2-3 weeks before planting\nЁЯМ╛ **Seed Selection**: Use certified, disease-resistant varieties suited to your region\nЁЯТз **Irrigation**: Maintain consistent moisture - drip irrigation saves 30-50% water\nЁЯМбя╕П **Timing**: Plant according to monsoon patterns - Kharif (June-July), Rabi (Oct-Dec)\nЁЯФД **Crop Rotation**: Rotate legumes with cereals to maintain soil fertility\n\nWhich specific crop are you planning to grow? I can provide detailed guidance!",
      hi: "рднрд╛рд░рдд рдореЗрдВ рд╕рдлрд▓ рдлрд╕рд▓ рдХреА рдЦреЗрддреА рдХреЗ рд▓рд┐рдП:\n\nЁЯМ▒ **рдорд┐рдЯреНрдЯреА рдХреА рддреИрдпрд╛рд░реА**: рдорд┐рдЯреНрдЯреА рдХрд╛ pH рдЯреЗрд╕реНрдЯ рдХрд░реЗрдВ (6.0-7.5 рдЖрджрд░реНрд╢), рдмреБрдЖрдИ рд╕реЗ 2-3 рд╕рдкреНрддрд╛рд╣ рдкрд╣рд▓реЗ рдЬреИрд╡рд┐рдХ рдЦрд╛рдж рдбрд╛рд▓реЗрдВ\nЁЯМ╛ **рдмреАрдЬ рдЪрдпрди**: рдЕрдкрдиреЗ рдХреНрд╖реЗрддреНрд░ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рдкреНрд░рдорд╛рдгрд┐рдд, рд░реЛрдЧ рдкреНрд░рддрд┐рд░реЛрдзреА рдХрд┐рд╕реНрдореЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ\nЁЯТз **рд╕рд┐рдВрдЪрд╛рдИ**: рдирд┐рдпрдорд┐рдд рдирдореА рдмрдирд╛рдП рд░рдЦреЗрдВ - рдбреНрд░рд┐рдк рд╕рд┐рдВрдЪрд╛рдИ рд╕реЗ 30-50% рдкрд╛рдиреА рдХреА рдмрдЪрдд\nЁЯМбя╕П **рд╕рдордп**: рдорд╛рдирд╕реВрди рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдмреБрдЖрдИ рдХрд░реЗрдВ - рдЦрд░реАрдл (рдЬреВрди-рдЬреБрд▓рд╛рдИ), рд░рдмреА (рдЕрдХреНрдЯреВрдмрд░-рджрд┐рд╕рдВрдмрд░)\nЁЯФД **рдлрд╕рд▓ рдЪрдХреНрд░**: рдорд┐рдЯреНрдЯреА рдХреА рдЙрд░реНрд╡рд░рддрд╛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рджрд▓рд╣рди рдФрд░ рдЕрдирд╛рдЬ рдХреА рдЕрджрд▓рд╛-рдмрджрд▓реА рдХрд░реЗрдВ\n\nрдЖрдк рдХреМрди рд╕реА рд╡рд┐рд╢рд┐рд╖реНрдЯ рдлрд╕рд▓ рдЙрдЧрд╛рдиреЗ рдХреА рдпреЛрдЬрдирд╛ рдмрдирд╛ рд░рд╣реЗ рд╣реИрдВ?",
      te: "р░нр░╛р░░р░др░жр▒Зр░╢р░Вр░▓р▒Л р░╡р░┐р░Ьр░пр░╡р░Вр░др░ор▒Ир░и р░кр░Вр░Я р░╕р░╛р░Чр▒Б р░Хр▒Лр░╕р░В:\n\nЁЯМ▒ **р░ир▒Зр░▓ р░др░пр░╛р░░р▒А**: р░ир▒Зр░▓ pH р░кр░░р▒Ар░Хр▒Нр░╖р░┐р░Вр░Ър░Вр░бр░┐ (6.0-7.5 р░Жр░жр░░р▒Нр░╢р░В), р░ир░╛р░Яр░бр░╛р░ир░┐р░Хр░┐ 2-3 р░╡р░╛р░░р░╛р░▓ р░ор▒Бр░Вр░жр▒Б р░╕р▒Зр░Вр░жр▒Нр░░р▒Ар░п р░Ор░░р▒Бр░╡р▒Б р░╡р▒Зр░пр░Вр░бр░┐\nЁЯМ╛ **р░╡р░┐р░др▒Нр░др░и р░Ор░Вр░кр░┐р░Х**: р░ор▒А р░кр▒Нр░░р░╛р░Вр░др░╛р░ир░┐р░Хр▒Б р░Ер░ир▒Бр░Хр▒Вр░▓р░ор▒Ир░и р░зр▒Гр░╡р▒Ар░Хр░░р░┐р░Вр░Ър░мр░бр░┐р░и, р░╡р▒Нр░пр░╛р░зр░┐ р░ир░┐р░░р▒Лр░зр░Х р░░р░Хр░╛р░▓р░ир▒Б р░Йр░кр░пр▒Лр░Чр░┐р░Вр░Ър░Вр░бр░┐\nЁЯТз **р░ир▒Ар░Яр░┐р░кр░╛р░░р▒Бр░жр░▓**: р░╕р▒Нр░ер░┐р░░р░ор▒Ир░и р░др▒Зр░ор░ир▒Б р░ир░┐р░░р▒Нр░╡р░╣р░┐р░Вр░Ър░Вр░бр░┐ - р░бр▒Нр░░р░┐р░кр▒Н р░ир▒Ар░Яр░┐р░кр░╛р░░р▒Бр░жр░▓ 30-50% р░ир▒Ар░Яр░┐р░ир░┐ р░Жр░жр░╛ р░Ър▒Зр░╕р▒Нр░др▒Бр░Вр░жр░┐\nЁЯМбя╕П **р░╕р░ор░пр░В**: р░╡р░░р▒Нр░╖р░╛р░Хр░╛р░▓р░В р░кр▒Нр░░р░Хр░╛р░░р░В р░ир░╛р░Яр░Вр░бр░┐ - р░Цр░░р▒Ар░лр▒Н (р░Ьр▒Вр░ир▒Н-р░Ьр▒Вр░▓р▒И), р░░р░мр▒А (р░Ер░Хр▒Нр░Яр▒Лр░мр░░р▒Н-р░бр░┐р░╕р▒Жр░Вр░мр░░р▒Н)\nЁЯФД **р░кр░Вр░Я р░ор░╛р░░р▒Нр░кр░┐р░бр░┐**: р░ир▒Зр░▓ р░╕р░╛р░░р░╡р░Вр░др░д р░ир░┐р░░р▒Нр░╡р░╣р░┐р░Вр░Ър░бр░╛р░ир░┐р░Хр░┐ р░кр░кр▒Нр░кр▒Бр░зр░╛р░ир▒Нр░пр░╛р░▓р▒Б р░ор░░р░┐р░пр▒Б р░зр░╛р░ир▒Нр░пр░╛р░▓р░ир▒Б р░ор░╛р░░р▒Нр░Ър░Вр░бр░┐\n\nр░ор▒Ар░░р▒Б р░П р░ир░┐р░░р▒Нр░жр░┐р░╖р▒Нр░Я р░кр░Вр░Яр░ир▒Б р░кр░Вр░бр░┐р░Вр░Ър░╛р░▓р░ир░┐ р░Ер░ир▒Бр░Хр▒Бр░Вр░Яр▒Бр░ир▒Нр░ир░╛р░░р▒Б?",
    },
  },

  pests: {
    keywords: [
      "pest",
      "pests",
      "insect",
      "insects",
      "bug",
      "bugs",
      "disease",
      "diseases",
      "fungus",
      "bacteria",
      "virus",
      "aphid",
      "caterpillar",
      "bollworm",
      "thrips",
      "whitefly",
      "control",
      "spray",
      "pesticide",
      "organic",
    ],
    responses: {
      en: "Effective pest management for Indian crops:\n\nЁЯФН **Early Detection**: Check plants weekly, look for yellowing leaves, holes, or unusual spots\nЁЯМ┐ **Organic Solutions**:\n   тАв Neem oil spray (2-3ml/liter) - effective against aphids, thrips\n   тАв Turmeric + soap solution for fungal diseases\n   тАв Marigold companion planting deters many pests\n\nЁЯзк **Integrated Approach**:\n   тАв Use pheromone traps for bollworms\n   тАв Encourage beneficial insects (ladybugs, spiders)\n   тАв Rotate crops to break pest cycles\n\nтЪая╕П **Chemical Control**: Use only when necessary, follow label instructions\n\nWhat specific pest problem are you facing?",
      hi: "рднрд╛рд░рддреАрдп рдлрд╕рд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдкреНрд░рднрд╛рд╡реА рдХреАрдЯ рдкреНрд░рдмрдВрдзрди:\n\nЁЯФН **рдЬрд▓реНрджреА рдкрд╣рдЪрд╛рди**: рд╕рд╛рдкреНрддрд╛рд╣рд┐рдХ рдкреМрдзреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ, рдкреАрд▓реЗ рдкрддреНрддреЗ, рдЫреЗрдж рдпрд╛ рдЕрд╕рд╛рдорд╛рдиреНрдп рдзрдмреНрдмреЗ рджреЗрдЦреЗрдВ\nЁЯМ┐ **рдЬреИрд╡рд┐рдХ рд╕рдорд╛рдзрд╛рди**:\n   тАв рдиреАрдо рддреЗрд▓ рд╕реНрдкреНрд░реЗ (2-3ml/рд▓реАрдЯрд░) - рдПрдлрд┐рдбреНрд╕, рдереНрд░рд┐рдкреНрд╕ рдХреЗ рдЦрд┐рд▓рд╛рдл рдкреНрд░рднрд╛рд╡реА\n   тАв рд╣рд▓реНрджреА + рд╕рд╛рдмреБрди рдХрд╛ рдШреЛрд▓ рдлрдВрдЧрд▓ рд░реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП\n   тАв рдЧреЗрдВрджреЗ рдХреА рд╕рд╣рдпреЛрдЧреА рдЦреЗрддреА рдХрдИ рдХреАрдЯреЛрдВ рдХреЛ рджреВрд░ рд░рдЦрддреА рд╣реИ\n\nЁЯзк **рдПрдХреАрдХреГрдд рджреГрд╖реНрдЯрд┐рдХреЛрдг**:\n   тАв рдмреЙрд▓рд╡рд░реНрдо рдХреЗ рд▓рд┐рдП рдлреЗрд░реЛрдореЛрди рдЯреНрд░реИрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ\n   тАв рд▓рд╛рднрдХрд╛рд░реА рдХреАрдЯреЛрдВ рдХреЛ рдкреНрд░реЛрддреНрд╕рд╛рд╣рд┐рдд рдХрд░реЗрдВ\n   тАв рдХреАрдЯ рдЪрдХреНрд░ рддреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╕рд▓ рдЪрдХреНрд░ рдЕрдкрдирд╛рдПрдВ\n\nтЪая╕П **рд░рд╛рд╕рд╛рдпрдирд┐рдХ рдирд┐рдпрдВрддреНрд░рдг**: рдХреЗрд╡рд▓ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрдиреЗ рдкрд░ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ\n\nрдЖрдк рдХрд┐рд╕ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреАрдЯ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░ рд░рд╣реЗ рд╣реИрдВ?",
      te: "р░нр░╛р░░р░др▒Ар░п р░кр░Вр░Яр░▓р░Хр▒Б р░кр▒Нр░░р░нр░╛р░╡р░╡р░Вр░др░ор▒Ир░и р░Хр▒Ар░Яр░Х р░ир░┐р░░р▒Нр░╡р░╣р░г:\n\nЁЯФН **р░ор▒Бр░Вр░жр░╕р▒Нр░др▒Б р░Чр▒Бр░░р▒Нр░др░┐р░Вр░кр▒Б**: р░╡р░╛р░░р░╛р░ир░┐р░Хр░┐ р░ор▒Кр░Хр▒Нр░Хр░▓р░ир▒Б р░др░ир░┐р░Цр▒А р░Ър▒Зр░пр░Вр░бр░┐, р░кр░╕р▒Бр░кр▒Б р░Жр░Хр▒Бр░▓р▒Б, р░░р░Вр░зр▒Нр░░р░╛р░▓р▒Б р░▓р▒Зр░жр░╛ р░Ер░╕р░╛р░зр░╛р░░р░г р░ор░Ър▒Нр░Ър░▓р░ир▒Б р░Ър▒Вр░бр░Вр░бр░┐\nЁЯМ┐ **р░╕р▒Зр░Вр░жр▒Нр░░р▒Ар░п р░кр░░р░┐р░╖р▒Нр░Хр░╛р░░р░╛р░▓р▒Б**:\n   тАв р░╡р▒Зр░к р░ир▒Вр░ир▒Ж р░╕р▒Нр░кр▒Нр░░р▒З (2-3ml/р░▓р▒Ар░Яр░░р▒Н) - р░Ер░лр░┐р░бр▒Нр░╕р▒Н, р░ер▒Нр░░р░┐р░кр▒Нр░╕р▒НтАМр░Хр▒Б р░╡р▒Нр░пр░др░┐р░░р▒Зр░Хр░Вр░Чр░╛ р░кр▒Нр░░р░нр░╛р░╡р░╡р░Вр░др░В\n   тАв р░кр░╕р▒Бр░кр▒Б + р░╕р░мр▒Нр░мр▒Б р░жр▒Нр░░р░╛р░╡р░гр░В р░лр░Вр░Чр░▓р▒Н р░╡р▒Нр░пр░╛р░зр▒Бр░▓р░Хр▒Б\n   тАв р░мр░Вр░др░┐р░кр▒Бр░╡р▒Нр░╡р▒Б р░╕р░╣р░Ър░░ р░ир░╛р░Яр░бр░В р░Ер░ир▒Зр░Х р░Хр▒Ар░Яр░Хр░╛р░▓р░ир▒Б р░жр▒Вр░░р░В р░Ър▒Зр░╕р▒Нр░др▒Бр░Вр░жр░┐\n\nЁЯзк **р░╕р░ор░Чр▒Нр░░ р░╡р░┐р░зр░╛р░ир░В**:\n   тАв р░мр░╛р░▓р▒НтАМр░╡р░╛р░░р▒Нр░ор▒НтАМр░▓р░Хр▒Б р░лр▒Жр░░р▒Лр░ор▒Лр░ир▒Н р░Яр▒Нр░░р░╛р░кр▒НтАМр░▓р░ир▒Б р░Йр░кр░пр▒Лр░Чр░┐р░Вр░Ър░Вр░бр░┐\n   тАв р░кр▒Нр░░р░пр▒Лр░Ьр░ир░Хр░░р░ор▒Ир░и р░Хр▒Ар░Яр░Хр░╛р░▓р░ир▒Б р░кр▒Нр░░р▒Лр░др▒Нр░╕р░╣р░┐р░Вр░Ър░Вр░бр░┐\n   тАв р░Хр▒Ар░Яр░Х р░Ър░Хр▒Нр░░р░╛р░▓р░ир▒Б р░╡р░┐р░Ър▒Нр░Ыр░┐р░ир▒Нр░ир░В р░Ър▒Зр░пр░бр░╛р░ир░┐р░Хр░┐ р░кр░Вр░Я р░ор░╛р░░р▒Нр░кр░┐р░бр░┐ р░Ър▒Зр░пр░Вр░бр░┐\n\nтЪая╕П **р░░р░╕р░╛р░пр░и р░ир░┐р░пр░Вр░др▒Нр░░р░г**: р░Ер░╡р░╕р░░р░ор▒Ир░ир░кр▒Нр░кр▒Бр░бр▒Б р░ор░╛р░др▒Нр░░р░ор▒З р░Йр░кр░пр▒Лр░Чр░┐р░Вр░Ър░Вр░бр░┐\n\nр░ор▒Ар░░р▒Б р░П р░ир░┐р░░р▒Нр░жр░┐р░╖р▒Нр░Я р░Хр▒Ар░Яр░Х р░╕р░ор░╕р▒Нр░пр░ир▒Б р░Ор░жр▒Бр░░р▒Нр░Хр▒Кр░Вр░Яр▒Бр░ир▒Нр░ир░╛р░░р▒Б?",
    },
  },

  soil: {
    keywords: [
      "soil",
      "earth",
      "dirt",
      "fertility",
      "ph",
      "nutrients",
      "fertilizer",
      "compost",
      "organic",
      "manure",
      "nitrogen",
      "phosphorus",
      "potassium",
      "npk",
      "testing",
      "improvement",
    ],
    responses: {
      en: "Soil health is the foundation of successful farming:\n\nЁЯзк **Soil Testing**: Test every 2-3 years for pH, NPK, organic matter\n   тАв Ideal pH: 6.0-7.5 for most crops\n   тАв Cost: тВ╣200-500 at agricultural universities\n\nЁЯМ▒ **Improving Soil Fertility**:\n   тАв Add 2-3 tons compost per acre annually\n   тАв Green manuring with dhaincha, sunhemp\n   тАв Vermicompost: 1-2 tons per acre\n\nтЪЦя╕П **Nutrient Management**:\n   тАв Nitrogen: For leafy growth (urea 100-150 kg/acre)\n   тАв Phosphorus: For root development (DAP 50-75 kg/acre)\n   тАв Potassium: For disease resistance (MOP 25-50 kg/acre)\n\nWhat's your current soil condition?",
      hi: "рдорд┐рдЯреНрдЯреА рдХрд╛ рд╕реНрд╡рд╛рд╕реНрдереНрдп рд╕рдлрд▓ рдЦреЗрддреА рдХреА рдиреАрдВрд╡ рд╣реИ:\n\nЁЯзк **рдорд┐рдЯреНрдЯреА рдкрд░реАрдХреНрд╖рдг**: pH, NPK, рдЬреИрд╡рд┐рдХ рдкрджрд╛рд░реНрде рдХреЗ рд▓рд┐рдП рд╣рд░ 2-3 рд╕рд╛рд▓ рдореЗрдВ рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВ\n   тАв рдЖрджрд░реНрд╢ pH: рдЕрдзрд┐рдХрд╛рдВрд╢ рдлрд╕рд▓реЛрдВ рдХреЗ рд▓рд┐рдП 6.0-7.5\n   тАв рд▓рд╛рдЧрдд: рдХреГрд╖рд┐ рд╡рд┐рд╢реНрд╡рд╡рд┐рджреНрдпрд╛рд▓рдпреЛрдВ рдореЗрдВ тВ╣200-500\n\nЁЯМ▒ **рдорд┐рдЯреНрдЯреА рдХреА рдЙрд░реНрд╡рд░рддрд╛ рдореЗрдВ рд╕реБрдзрд╛рд░**:\n   тАв рдкреНрд░рддрд┐ рдПрдХрдбрд╝ рд╕рд╛рд▓рд╛рдирд╛ 2-3 рдЯрди рдХрдВрдкреЛрд╕реНрдЯ рдбрд╛рд▓реЗрдВ\n   тАв рдвреИрдВрдЪрд╛, рд╕рдирдИ рд╕реЗ рд╣рд░реА рдЦрд╛рдж\n   тАв рд╡рд░реНрдореАрдХрдВрдкреЛрд╕реНрдЯ: 1-2 рдЯрди рдкреНрд░рддрд┐ рдПрдХрдбрд╝\n\nтЪЦя╕П **рдкреЛрд╖рдХ рддрддреНрд╡ рдкреНрд░рдмрдВрдзрди**:\n   тАв рдирд╛рдЗрдЯреНрд░реЛрдЬрди: рдкрддреНрддреЗрджрд╛рд░ рд╡реГрджреНрдзрд┐ рдХреЗ рд▓рд┐рдП (рдпреВрд░рд┐рдпрд╛ 100-150 рдХрд┐рдЧреНрд░рд╛/рдПрдХрдбрд╝)\n   тАв рдлрд╛рд╕реНрдлреЛрд░рд╕: рдЬрдбрд╝ рд╡рд┐рдХрд╛рд╕ рдХреЗ рд▓рд┐рдП (DAP 50-75 рдХрд┐рдЧреНрд░рд╛/рдПрдХрдбрд╝)\n   тАв рдкреЛрдЯреЗрд╢рд┐рдпрдо: рд░реЛрдЧ рдкреНрд░рддрд┐рд░реЛрдзрд╛ рдХреЗ рд▓рд┐рдП (MOP 25-50 рдХрд┐рдЧреНрд░рд╛/рдПрдХрдбрд╝)\n\nрдЖрдкрдХреА рд╡рд░реНрддрдорд╛рди рдорд┐рдЯреНрдЯреА рдХреА рд╕реНрдерд┐рддрд┐ рдХреНрдпрд╛ рд╣реИ?",
    },
  },

  weather: {
    keywords: [
      "weather",
      "rain",
      "monsoon",
      "drought",
      "temperature",
      "humidity",
      "climate",
      "season",
      "kharif",
      "rabi",
      "zaid",
      "irrigation",
      "water",
    ],
    responses: {
      en: "Weather-smart farming for Indian conditions:\n\nЁЯМзя╕П **Monsoon Planning**:\n   тАв Southwest monsoon: June-September (Kharif season)\n   тАв Northeast monsoon: October-December (Rabi season)\n   тАв Pre-monsoon preparation: Clear drainage, repair bunds\n\nтШАя╕П **Season-wise Crops**:\n   тАв **Kharif** (June-Oct): Rice, cotton, sugarcane, maize\n   тАв **Rabi** (Nov-Apr): Wheat, barley, mustard, gram\n   тАв **Zaid** (Apr-June): Fodder, vegetables with irrigation\n\nЁЯТз **Water Management**:\n   тАв Rainwater harvesting: Build farm ponds\n   тАв Mulching reduces water loss by 50-70%\n   тАв Drip irrigation for water-scarce areas\n\nWhich season are you planning for?",
      hi: "рднрд╛рд░рддреАрдп рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдореМрд╕рдо-рд╕реНрдорд╛рд░реНрдЯ рдЦреЗрддреА:\n\nЁЯМзя╕П **рдорд╛рдирд╕реВрди рдпреЛрдЬрдирд╛**:\n   тАв рджрдХреНрд╖рд┐рдг-рдкрд╢реНрдЪрд┐рдо рдорд╛рдирд╕реВрди: рдЬреВрди-рд╕рд┐рддрдВрдмрд░ (рдЦрд░реАрдл рд╕реАрдЬрди)\n   тАв рдЙрддреНрддрд░-рдкреВрд░реНрд╡ рдорд╛рдирд╕реВрди: рдЕрдХреНрдЯреВрдмрд░-рджрд┐рд╕рдВрдмрд░ (рд░рдмреА рд╕реАрдЬрди)\n   тАв рдорд╛рдирд╕реВрди рдкреВрд░реНрд╡ рддреИрдпрд╛рд░реА: рдЬрд▓ рдирд┐рдХрд╛рд╕реА рд╕рд╛рдл рдХрд░реЗрдВ, рдмрд╛рдВрдз рдХреА рдорд░рдореНрдордд рдХрд░реЗрдВ\n\nтШАя╕П **рдореМрд╕рдо рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдлрд╕рд▓реЗрдВ**:\n   тАв **рдЦрд░реАрдл** (рдЬреВрди-рдЕрдХреНрдЯреВрдмрд░): рдзрд╛рди, рдХрдкрд╛рд╕, рдЧрдиреНрдирд╛, рдордХреНрдХрд╛\n   тАв **рд░рдмреА** (рдирд╡рдВрдмрд░-рдЕрдкреНрд░реИрд▓): рдЧреЗрд╣реВрдВ, рдЬреМ, рд╕рд░рд╕реЛрдВ, рдЪрдирд╛\n   тАв **рдЬрд╛рдпрдж** (рдЕрдкреНрд░реИрд▓-рдЬреВрди): рдЪрд╛рд░рд╛, рд╕рд┐рдВрдЪрд╛рдИ рдХреЗ рд╕рд╛рде рд╕рдмреНрдЬрд┐рдпрд╛рдВ\n\nЁЯТз **рдЬрд▓ рдкреНрд░рдмрдВрдзрди**:\n   тАв рд╡рд░реНрд╖рд╛ рдЬрд▓ рд╕рдВрдЪрдпрди: рдлрд╛рд░реНрдо рддрд╛рд▓рд╛рдм рдмрдирд╛рдПрдВ\n   тАв рдорд▓реНрдЪрд┐рдВрдЧ рд╕реЗ 50-70% рдкрд╛рдиреА рдХреА рд╣рд╛рдирд┐ рдХрдо рд╣реЛрддреА рд╣реИ\n   тАв рдкрд╛рдиреА рдХреА рдХрдореА рд╡рд╛рд▓реЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдбреНрд░рд┐рдк рд╕рд┐рдВрдЪрд╛рдИ\n\nрдЖрдк рдХрд┐рд╕ рдореМрд╕рдо рдХреА рдпреЛрдЬрдирд╛ рдмрдирд╛ рд░рд╣реЗ рд╣реИрдВ?",
    },
  },

  general: {
    keywords: [
      "help",
      "advice",
      "farming",
      "agriculture",
      "question",
      "problem",
      "issue",
      "guidance",
      "support",
      "assistance",
    ],
    responses: {
      en: "Welcome to your AI Farming Assistant! ЁЯМ╛\n\nI'm here to help you with all aspects of farming:\n\nЁЯМ▒ **Crop Cultivation**: Planting, growing, harvesting techniques\nЁЯРЫ **Pest & Disease Management**: Organic and chemical solutions\nЁЯМН **Soil Health**: Testing, fertilization, improvement methods\nЁЯМзя╕П **Weather & Irrigation**: Seasonal planning, water management\nЁЯТ░ **Market Information**: Pricing, government schemes, subsidies\nЁЯФм **Modern Techniques**: Precision farming, technology adoption\n\nFeel free to ask me anything about farming! I can provide advice in multiple Indian languages.\n\nWhat farming challenge can I help you with today?",
      hi: "рдЖрдкрдХреЗ AI рдХреГрд╖рд┐ рд╕рд╣рд╛рдпрдХ рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ! ЁЯМ╛\n\nрдореИрдВ рдЦреЗрддреА рдХреЗ рд╕рднреА рдкрд╣рд▓реБрдУрдВ рдореЗрдВ рдЖрдкрдХреА рдорджрдж рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдВ рд╣реВрдВ:\n\nЁЯМ▒ **рдлрд╕рд▓ рдХреА рдЦреЗрддреА**: рдмреБрдЖрдИ, рдЙрдЧрд╛рдирд╛, рдХрдЯрд╛рдИ рдХреА рддрдХрдиреАрдХреЗрдВ\nЁЯРЫ **рдХреАрдЯ рдФрд░ рд░реЛрдЧ рдкреНрд░рдмрдВрдзрди**: рдЬреИрд╡рд┐рдХ рдФрд░ рд░рд╛рд╕рд╛рдпрдирд┐рдХ рд╕рдорд╛рдзрд╛рди\nЁЯМН **рдорд┐рдЯреНрдЯреА рдХрд╛ рд╕реНрд╡рд╛рд╕реНрдереНрдп**: рдкрд░реАрдХреНрд╖рдг, рдЙрд░реНрд╡рд░реАрдХрд░рдг, рд╕реБрдзрд╛рд░ рдХреЗ рддрд░реАрдХреЗ\nЁЯМзя╕П **рдореМрд╕рдо рдФрд░ рд╕рд┐рдВрдЪрд╛рдИ**: рдореМрд╕рдореА рдпреЛрдЬрдирд╛, рдЬрд▓ рдкреНрд░рдмрдВрдзрди\nЁЯТ░ **рдмрд╛рдЬрд╛рд░ рдХреА рдЬрд╛рдирдХрд╛рд░реА**: рдореВрд▓реНрдп рдирд┐рд░реНрдзрд╛рд░рдг, рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛рдПрдВ, рд╕рдмреНрд╕рд┐рдбреА\nЁЯФм **рдЖрдзреБрдирд┐рдХ рддрдХрдиреАрдХреЗрдВ**: рд╕рдЯреАрдХ рдЦреЗрддреА, рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдЕрдкрдирд╛рдирд╛\n\nрдЦреЗрддреА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдореБрдЭрд╕реЗ рдХреБрдЫ рднреА рдкреВрдЫрдиреЗ рдореЗрдВ рд╕рдВрдХреЛрдЪ рди рдХрд░реЗрдВ!\n\nрдЖрдЬ рдореИрдВ рдЖрдкрдХреА рдХрд┐рд╕ рдХреГрд╖рд┐ рдЪреБрдиреМрддреА рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВ?",
    },
  },
}

function findBestResponse(message: string, language: string): string {
  const messageLower = message.toLowerCase()
  let bestMatch = { category: "general", score: 0 }

  // Find the best matching category based on keywords
  for (const [category, data] of Object.entries(farmingKnowledgeBase)) {
    const matchCount = data.keywords.filter((keyword) => messageLower.includes(keyword.toLowerCase())).length

    if (matchCount > bestMatch.score) {
      bestMatch = { category, score: matchCount }
    }
  }

  const selectedCategory = farmingKnowledgeBase[bestMatch.category]
  return selectedCategory.responses[language] || selectedCategory.responses.en || selectedCategory.responses.hi
}

export async function POST(request: NextRequest) {
  try {
    const { message, language = "en", history = [] } = await request.json()

    const response = findBestResponse(message, language)

    return NextResponse.json({ response })
  } catch (error) {
    console.error("Error in farming assistant API:", error)

    const errorMessages = {
      en: "I'm sorry, I'm having trouble processing your request right now. Please try asking your farming question again.",
      hi: "рдХреНрд╖рдорд╛ рдХрд░реЗрдВ, рдореБрдЭреЗ рдЕрднреА рдЖрдкрдХреЗ рдЕрдиреБрд░реЛрдз рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдорд╕реНрдпрд╛ рд╣реЛ рд░рд╣реА рд╣реИред рдХреГрдкрдпрд╛ рдЕрдкрдирд╛ рдХреГрд╖рд┐ рдкреНрд░рд╢реНрди рдлрд┐рд░ рд╕реЗ рдкреВрдЫреЗрдВред",
      te: "р░Хр▒Нр░╖р░ор░┐р░Вр░Ър░Вр░бр░┐, р░ир▒Зр░ир▒Б р░Зр░кр▒Нр░кр▒Бр░бр▒Б р░ор▒А р░Ер░нр▒Нр░пр░░р▒Нр░ер░ир░ир▒Б р░кр▒Нр░░р░╛р░╕р▒Жр░╕р▒Н р░Ър▒Зр░пр░бр░Вр░▓р▒Л р░Зр░мр▒Нр░мр░Вр░жр░┐ р░кр░бр▒Бр░др▒Бр░ир▒Нр░ир░╛р░ир▒Бред р░жр░пр░Ър▒Зр░╕р░┐ р░ор▒А р░╡р▒Нр░пр░╡р░╕р░╛р░п р░кр▒Нр░░р░╢р▒Нр░ир░ир▒Б р░ор░│р▒Нр░▓р▒А р░Ер░бр░Чр░Вр░бр░┐ред",
      ta: "рооройрпНройро┐роХрпНроХро╡рпБроорпН, роЙроЩрпНроХро│рпН роХрпЛро░ро┐роХрпНроХрпИропрпИ роЗрокрпНрокрпЛродрпБ роЪрпЖропро▓ро╛роХрпНроХрпБро╡родро┐ро▓рпН роОройроХрпНроХрпБ роЪро┐роХрпНроХро▓рпН роЙро│рпНро│родрпБред родропро╡рпБроЪрпЖропрпНродрпБ роЙроЩрпНроХро│рпН ро╡ро┐ро╡роЪро╛роп роХрпЗро│рпНро╡ро┐ропрпИ роорпАрогрпНроЯрпБроорпН роХрпЗро│рпБроЩрпНроХро│рпНред",
      bn: "ржжрзБржГржЦрж┐ржд, ржЖржорж┐ ржПржЦржи ржЖржкржирж╛рж░ ржЕржирзБрж░рзЛржз ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ржпрж╝ ржкржбрж╝рзЗржЫрж┐ред ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржЖржкржирж╛рж░ ржХрзГрж╖рж┐ ржкрзНрж░рж╢рзНржи ржЖржмрж╛рж░ ржЬрж┐ржЬрзНржЮрж╛рж╕рж╛ ржХрж░рзБржиред",
      gu: "ркорк╛ркл ркХрк░рк╢рлЛ, ркоркирлЗ ркЕркдрлНркпрк╛рк░рлЗ ркдркорк╛рк░рлА рк╡рк┐ркиркВркдрлА рккрлНрк░ркХрлНрк░рк┐ркпрк╛ ркХрк░рк╡рк╛ркорк╛ркВ ркорлБрк╢рлНркХрлЗрк▓рлА ркЖрк╡рлА рк░рк╣рлА ркЫрлЗ. ркХрлГрккрк╛ ркХрк░рлАркирлЗ ркдркорк╛рк░рлЛ ркЦрлЗркдрлАркирлЛ рккрлНрк░рк╢рлНрки рклрк░рлАркерлА рккрлВркЫрлЛред",
      mr: "рдорд╛рдл рдХрд░рд╛, рдорд▓рд╛ рдЖрддреНрддрд╛ рддреБрдордЪреА рд╡рд┐рдирдВрддреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд░рдгреНрдпрд╛рдд рдЕрдбрдЪрдг рдпреЗрдд рдЖрд╣реЗ. рдХреГрдкрдпрд╛ рддреБрдордЪрд╛ рд╢реЗрддреАрдЪрд╛ рдкреНрд░рд╢реНрди рдкреБрдиреНрд╣рд╛ рд╡рд┐рдЪрд╛рд░рд╛ред",
      pa: "риори╛рилри╝ риХри░рйЛ, риорйИриирйВрй░ ри╣рйБриг ридрйБри╣ри╛рибрйА римрйЗрииридрйА рижрйА рикрйНри░риХри┐ри░ри┐риЖ риХри░рии ри╡ри┐рй▒риЪ ри╕риорй▒ри╕ри┐риЖ риЖ ри░ри╣рйА ри╣рйИред риХри┐ри░рикри╛ риХри░риХрйЗ риЖрикригри╛ риЦрйЗридрйА рижри╛ ри╕ри╡ри╛ри▓ рижрйБримри╛ри░ри╛ рикрйБрй▒риЫрйЛред",
    }

    let requestLanguage = "en"
    try {
      const requestBody = await request.json()
      requestLanguage = requestBody.language || "en"
    } catch {
      // If parsing fails, use default language
    }

    const errorMessage = errorMessages[requestLanguage as keyof typeof errorMessages] || errorMessages.en

    return NextResponse.json({ response: errorMessage })
  }
}
